<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

</head>
<body>

<div class="container-fluid">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#" id="page-title">Employee Page</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/reimbursement">Home <span class="sr-only">(current)</span></a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#" id="employee-name" class="profile-link"></a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/profile" class="profile-link">Profile</a></li>
                            <li><a href="#" onclick="logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
</div>

<div class="container" style="width:850px">
    <form role="form" class="form-horizontal" id="request-form">
        <div class="form-group">
            <label for="amount" class="col-sm-2 control-label">
                Amount</label>
            <div class="col-sm-10">
                <input type="number" class="form-control" id="amount" placeholder="Amount" name="amount" step="any"/>
            </div>
        </div>
        <div class="form-group">
            <label for="category" class="col-sm-2 control-label">
                Categories</label>
            <div class="col-sm-10" id="category">
                <select name="category" class="form-control">
                    <option >Select </option>
                    <option >Hotel </option>
                    <option >Office </option>
                    <option >Travel </option>
                    <option >Food </option>
                </select>
            </div>
        </div>
        <input type="hidden" name="employeeId" id="employeeInput">
        <div class="row">
            <div class="col-sm-2">
            </div>
            <div class="col-sm-10">
                <button type="submit" class="btn btn-primary btn-sm">
                    Submit</button>
            </div>
        </div>
    </form>
    <br/>

    <h3 class="text-center">View Reimbursements</h3>
    <table  class="table">
    <thead>
    <tr>
    <td>ReimbursementId</td>
        <td>EmpId</td>
    <td>Amount</td>
    <td>Category</td>
    <td>Status</td>
        <td id="resolver" style="display: none">Resolver</td>
        <td></td>
    </tr>
    </thead>
    <tbody id="request-list"></tbody>

</table>
    <div id="employees" style="display: none">
    <h3 class="text-center">View Employees</h3>
    <table  class="table">
        <thead>
        <tr>
            <td>EmpId</td>
            <td>Name</td>
            <td>Lastname</td>
            <td>Username</td>
            <td>Email</td>
            <td>Role</td>
            <td></td>
        </tr>
        </thead>
        <tbody id="employee-list"></tbody>

    </table>
    </div>
</div>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script>
    let session=localStorage.getItem("session");
    console.log(session);
    if(session=='false'){
    location.href="http://localhost:8080/login";
    }
    $('#request-form').on('submit',function(e){
        e.preventDefault();
        let reimdata = $(this).serializeArray();
        $.ajax({
           type:'post',
           url:'http://localhost:8080/reimbursement',
           data:reimdata,
           success:function(response){
            alert("success");
           },
           error:function(){
            alert("failed");
           }

        });

    });
    let emp = JSON.parse(localStorage.getItem("data"));
    $('#employeeInput').val(emp.employeeId);
    $('#employee-name').text(emp.firstname);
    $('.profile-link').attr('href','/employeeProfile/'+emp.employeeId);
    if (parseInt(emp.roleId)===1){
        $('#page-title').text("Manager Page");
        $('#employees').show();
        $('#resolver').show();
        $('#request-form').hide();// Manager sayfasında gizlenecek employee da görüneek ondan dolayı bu kodu koydul ok

    }
    $.ajax({
           type:'get',
           url:'http://localhost:8080/reimbursement/'+emp.employeeId,
           success:function(response){
           let data=JSON.parse(response);
           console.log(data);
           let reimbursements = data.reimbursements;
           let employees = data.employees;

           let tr = '';
           for(let i =0;i<reimbursements.length;i++){
            tr += '<tr><td>'+reimbursements[i].reimbersementId+'</td><td>'+reimbursements[i].employeeId+'</td><td>'+reimbursements[i].amount+'</td><td>'+reimbursements[i].category+'</td><td>'+reimbursements[i].status+'</td>';
            if (parseInt(emp.roleId)===1&&(reimbursements[i].status!=="Approve"||reimbursements[i].status!=="Denied")){
                tr+='<td>'+reimbursements[i].resolver+'</td><td><a href="/reimbursement?p=Approve&id='+reimbursements[i].reimbersementId+'" class="btn btn-success">Approve</a>|<a href="/reimbursement?p=Denied&id='+reimbursements[i].reimbersementId+'" class="btn btn-danger">Denied</a></td>';
            }
            tr+="</tr>";
           }
            $('#request-list').append(tr);
               tr = '';
               console.log(employees);
               for(let i =0;i<employees.length;i++){
                   tr += '<tr><td>'+employees[i].employeeId+'</td><td>'+employees[i].firstname+'</td><td>'+employees[i].lastname+'</td><td>'+employees[i].username+'</td><td>'+employees[i].email+'</td><td>'+employees[i].roleId
                       +'</td><td><a href="/employeeProfile/'+employees[i].employeeId+'" class="btn btn-info">Update</a></td> </td></tr>';

               }
               $('#employee-list').append(tr);
            console.log();
           },
           error:function(){
            alert("failed");
           }

        });

        function logout(){
            localStorage.setItem("data",null);
            localStorage.setItem("session",false);
            location.href="http://localhost:8080/login";

        }


</script>
</body>
</html>
